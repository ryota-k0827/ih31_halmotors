<!--入札画面・商品詳細ページ-->
<%- include('../partials/header.ejs') %>
<style>
.top{
  display: flex;
  justify-content: space-around;
}
.top img{
  width: 30%; 
  height: auto;
}
.top h1{
  font-size: 40px;
}
.top h2{
  font-size: 25px;
  color: #808080;
  margin-bottom: 50px;
}
.detail{
  margin-left: 30px;
  
}
.button1{
  font-size: 30px;
  width: 500px;
  background-color: rgb(61, 122, 192);
  text-align: center;
  border:  2px solid rgb(46, 93, 146);
  border-radius: 0.25rem;
}
.button2{
  padding-top: 8px;
  font-size: 30px;
  width: 500px;
  background-color: #f1eded;
  text-align: center;
  border:  2px solid rgb(119, 119, 119);
  height: 90px;
  border-radius: 0.125rem;
}
.input-text{
  width: 500px;
  height: 50px;
  font-size: 30px;
  margin-bottom: 20px;
  border:  2px solid rgb(119, 119, 119);
  border-radius: 0.125rem;
}
</style>
<body>
  <div class="top">
    <img class="object-contain" src="/public/img/<%= name %>.jpg">
    <div class="car_name">
      <h1><%= name %></h1>
      <h2 id="getPrice">現在の価格: <%= flg=(bid.price)?Number(bid.price).toLocaleString():Number(start_price).toLocaleString(); %>円</h2>
        <form action="/bid/confirm/<%= listing_id %>" method="POST">
          <input type="hidden" id="name" name="name" value="<%= name %>" />
          <input type="hidden" id="pageId" name="pageId" value="<%= page_id %>" />
          <input type="number" class="input-text" id="price" name="price" autofocus="autofocus" required min="<%= flg=(bid.price)?Number(bid.price+1000):Number(start_price+1000); %>" value="<%= flg=(bid.price)?Number(bid.price+1000):Number(start_price+1000); %>" step="1000"/><br>
          <button id="sendButton" class="button1" type="submit">入札する</button>
        </form>
      <div class="button2">  
          <h2>残り時間&nbsp;&nbsp;<div id="time">00:00</div></h2>
      </div>
    </div>
  </div>
  <div class="detail">
    <div class="space-y-5">
      <!-- 車両評価 -->
      <div class="p-3 bg-white shadow rounded-lg">
        <h3 class="text-xs border-b">車両評価</h3>
        <p class="font-sans">
          <%= evaluation %>
        </p>
      </div>
      <!-- 外装評価 -->
      <div class="p-3 bg-white shadow rounded-lg">
        <h3 class="text-xs border-b">外装評価</h3>
        <p class="font-serif">
          <%= outer_evaluation %>
        </p>
      </div>
        <!-- 内装評価 -->
      <div class="p-3 bg-white shadow rounded-lg">
        <h3 class="text-xs border-b">内装評価</h3>
        <p class="font-serif">
          <%= inner_evaluation %>
        </p>
      </div>
      <!-- 年式 -->
      <div class="p-3 bg-white shadow rounded-lg">
        <h3 class="text-xs border-b">年式</h3>
        <p class="font-serif">
          <%= model_year %>
        </p>
      </div>
      <!-- ドア数 -->
      <div class="p-3 bg-white shadow rounded-lg">
        <h3 class="text-xs border-b">ドア数</h3>
        <p class="font-serif">
          <%= door %>
        </p>
      </div>
      <div class="space-y-5">
        <!-- 車体グレード-->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">車体グレード</h3>
          <p class="font-sans">
            <%= grade %>
          </p>
        </div>
        <!-- 車歴 -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">車歴</h3>
          <p class="font-serif">
            <%= history %>
          </p>
        </div>
          <!-- 型式 -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">型式</h3>
          <p class="font-serif">
            <%= model %>
          </p>
        </div>
        <!-- 排気量 -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">排気量</h3>
          <p class="font-serif">
            <%= engine_size %>
          </p>
        </div>
        <!-- 燃料 -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">燃料</h3>
          <p class="font-serif">
            <%= fuel_type %>
          </p>
        </div>
        <!-- 車検日 -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">車検日</h3>
          <p class="font-serif">
            <%= moment(inspection_day).format("YYYY/MM/DD") %>
          </p>
        </div>
        <!-- 走行距離 -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">走行距離</h3>
          <p class="font-serif">
            <%= mileage %>
          </p>
        </div>
        <!-- 外装色 -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">外装色</h3>
          <p class="font-serif">
            <%= outer_color %>
          </p>
        </div>
        <!-- 内装色 -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">内装色</h3>
          <p class="font-serif">
            <%= inner_color %>
          </p>
        </div>
        <!-- 色数 -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">色数</h3>
          <p class="font-serif">
            <%= color_number %>
          </p>
        </div>
        <!-- 車体番号 -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">車体番号</h3>
          <p class="font-serif">
            <%= identifier %>
          </p>
        </div>
        <!-- シフトタイプ -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">シフトタイプ</h3>
          <p class="font-serif">
            <%= shift_type %>
          </p>
        </div>
        <!-- ギアタイプ -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">ギアタイプ</h3>
          <p class="font-serif">
            <%= gear_type %>
          </p>
        </div>
        <!-- エアコンタイプ -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">エアコンタイプ</h3>
          <p class="font-serif">
            <%= ac_type %>
          </p>
        </div>
        <!-- パワーステアリング -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">パワーステアリング</h3>
          <p class="font-serif">
            <%= flg=(ps==1)?"○":"-"; %>
          </p>
        </div>
        <!-- パワーウィンド -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">パワーウィンド</h3>
          <p class="font-serif">
            <%= flg=(pw==1)?"○":"-"; %>
          </p>
        </div>
        <!-- アルミホイール -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">アルミホイール</h3>
          <p class="font-serif">
            <%= flg=(aw==1)?"○":"-"; %>
          </p>
        </div>
        <!-- サンルーフ -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">サンルーフ</h3>
          <p class="font-serif">
            <%= flg=(sr==1)?"○":"-"; %>
          </p>
        </div>
        <!-- タイヤ -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">タイヤ</h3>
          <p class="font-serif">
            <%= flg=(tire==1)?"○":"-"; %>
          </p>
        </div>
        <!-- 本革シート -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">本革シート</h3>
          <p class="font-serif">
            <%= flg=(leather_sheet==1)?"○":"バツ"; %>
          </p>
        </div>
        <!-- エアバック -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">エアバック</h3>
          <p class="font-serif">
            <%= flg=(ab==1)?"○":"-"; %>
          </p>
        </div>
        <!-- テレビ -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">テレビ</h3>
          <p class="font-serif">
            <%= flg=(tv==1)?"○":"-"; %>
          </p>
        </div>
        <!-- ナビ -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">ナビ</h3>
          <p class="font-serif">
            <%= flg=(navi==1)?"○":"-"; %>
          </p>
        </div>
        <!-- リアスポイラー -->
        <div class="p-3 bg-white shadow rounded-lg">
          <h3 class="text-xs border-b">リアスポイラー</h3>
          <p class="font-serif">
            <%= flg=(rear_spo==1)?"○":"-"; %>
          </p>
        </div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    let pageId = document.getElementById("pageId").value;
    let seconds, minutes;
    let time = document.getElementById("time");
    let sendButton = document.getElementById("sendButton");

    // サーバーから受信
    const socketio = io();
    socketio.on("s2c/"+pageId, (msg) => {
      console.log(msg);
      let h2 = document.getElementById("getPrice");
      let inputText = document.getElementById("price");
      h2.innerText = "現在の価格: " + Number(msg).toLocaleString() + "円";
      inputText.min = Number(msg)+1000;
      if (inputText.value < inputText.min) {
        inputText.value = inputText.min;
      };
    });

    socketio.on("timer", (data) => {
      time.innerText = data;
      if (data === "0:00") {
        sendButton.disabled = true;
        sendButton.innerText = "終了";
      };
    });
  </script>
</body>

<%- include('../partials/footer.ejs') %>